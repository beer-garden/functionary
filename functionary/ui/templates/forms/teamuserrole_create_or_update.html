{% extends "partials/modal.html" %}

{% block modal_title %}
    {% if create_user %}
        Add User
    {% else %}
        Update User's Role
    {% endif %}
{% endblock %}

{% block modal_description %}
    {% if create_user %}
        Add user to the team.
    {% else %}
        Update user's role for the team.
    {% endif %}
{% endblock %}

{% block form_declaration %}
    {% if create_user %}
        <form hx-post="{% url 'ui:create-team-member' team_id %}" method="post" hx-swap="outerHTML" hx-target="#form-modal">
    {% else %}
        <form hx-post="{% url 'ui:update-team-member' team_id team_user_role_id %}" method="post" hx-swap="outerHTML" hx-target="#form-modal">
    {% endif %}
{% endblock %}

{% block modal_content %}
{% csrf_token %}
<div class="columns is-multiline">
    {% if form.non_field_errors %}
    <div class="ml-3">
        {{ form.non_field_errors }}
    </div>
    {% endif %} 
    <div class="field column is-half">
        {% if create_user %}
            <label class="{% if form.user.errors %}errors{% endif %} label" for="user">User:</label>
            <input class="input is-medium" name="user" id="user" list="user-list"
            hx-get="{% url 'ui:get-users' %}"
            hx-trigger="keyup changed delay:500ms"
            hx-swap="outerHTML"
            hx-target="#user-list-block"/>
            {% include "partials/teams/user_list.html" with usernames=usernames %}
        {% else %}
            <label class="label" for="username-field">User:</label>
            <input id="username-field" class="input is-medium" disabled placeholder="{{ username }}"/>
            <input type="hidden" name="user" value="{{ user_id }}"/>
        {% endif %}
        <input type="hidden" name="team" value="{{ team_id }}"/>
        {{ form.user.errors }}
    </div>
    <div class="field column">
        <label class="{% if form.role.errors %}errors{% endif %} label" for="{{ form.role.id_for_label }}">Role:</label>
        <div class="select is-medium is-fullwidth">
            {{ form.role }}
        </div>
    </div>
</div>
{% endblock %}

{% block modal_footer %}
    {% if create_user %}
        <button class="button is-link is-medium" type="submit" value="Add User">Add User</button>
    {% else %}
        <button class="button is-link is-medium" type="submit" value="Update Role">Update Role</button>
    {% endif %}
{% endblock %}

{% block form_end %}
</form>
{% endblock %}